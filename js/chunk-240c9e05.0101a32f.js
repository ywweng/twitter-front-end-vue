(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-240c9e05"],{1582:function(t,e,a){},"1c8c":function(t,e,a){"use strict";a("7f3a")},"3d4f":function(t,e,a){"use strict";var r=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"modal fade",attrs:{id:"new-reply-modal",tabindex:"-1","aria-labelledby":"newReplyModalLabel","aria-hidden":"true"}},[r("div",{staticClass:"modal-dialog"},[r("div",{staticClass:"modal-content"},[t._m(0),r("div",{staticClass:"modal-body d-flex flex-column"},[r("div",{staticClass:"tweet-card d-flex"},[r("div",{staticClass:"h-100 d-flex flex-column"},[r("img",{staticClass:"avatar",attrs:{src:t.tweet.User.avatar,alt:"",width:"50px",height:"50px"}}),r("div",{staticClass:"border ms-4"})]),r("div",{staticClass:"tweet-info d-flex flex-column"},[r("div",{staticClass:"h-100"},[r("span",{staticClass:"text-name me-2"},[t._v(t._s(t.tweet.User.name))]),r("span",{staticClass:"text-account"},[t._v("@"+t._s(t.tweet.User.account)+"．"+t._s(t._f("fromNow")(t.tweet.createdAt)))])]),r("div",{staticClass:"tweet-content"},[t._v(" "+t._s(t.tweet.description)+" ")]),r("div",[r("span",{staticClass:"text-account"},[t._v("回覆給")]),r("span",{staticClass:"text-tag ms-2"},[t._v("@"+t._s(t.tweet.User.name))])])])]),r("div",{staticClass:"reply-content d-flex"},[r("div",[r("img",{staticClass:"avatar",attrs:{width:"50px",src:t.currentUser.avatar,alt:""}})]),r("textarea",{directives:[{name:"model",rawName:"v-model",value:t.comment,expression:"comment"}],staticClass:"input-new-tweet mt-2",attrs:{rows:"5",cols:"50",placeholder:"推你的回覆"},domProps:{value:t.comment},on:{input:function(e){e.target.composing||(t.comment=e.target.value)}}})])]),r("div",{staticClass:"modal-footer"},[t.isError?r("span",{staticClass:"text-danger"},[t._v(t._s(t.errorMsg))]):t._e(),r("button",{staticClass:"btn-active",attrs:{type:"submit"},on:{click:t.handleSubmit}},[t._v(" 回覆 ")])])])]),!1!==t.alertStatus?r("div",{staticClass:"alert d-flex fixed-top",attrs:{id:"alert",role:"alert"}},[r("div",{staticClass:"ms-2 mx-auto my-auto text-alert"},[t._v(t._s(t.alertMsg))]),r("div",{staticClass:"ms-auto"},["error"===t.alertStatus?r("img",{attrs:{src:a("ba0e")}}):"success"===t.alertStatus?r("img",{attrs:{src:a("08f6")}}):t._e()])]):t._e()])},s=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"modal-header"},[a("button",{staticClass:"btn-close",attrs:{type:"button","data-bs-dismiss":"modal","aria-label":"Close"}})])}],n=a("1da1"),i=a("5530"),c=(a("96cf"),a("d9e2"),a("c1df")),o=a.n(c),l=a("2f62"),u=a("6783"),d={name:"NewReplyModal",props:{tweet:{type:[Array,Object]}},data:function(){return{comment:"",alertMsg:"",alertStatus:!1,isError:!1,errorMsg:""}},computed:Object(i["a"])({},Object(l["b"])(["currentUser"])),filters:{fromNow:function(t){return t?o()(t).fromNow():"-"}},methods:{alertShow:function(){var t=this,e=a("7b17"),r=document.querySelector("#alert");e.Alert.getInstance(r),setTimeout((function(){t.alertStatus=!1}),2e3)},hideModal:function(){var t=a("7b17"),e=document.querySelector("#new-reply-modal"),r=t.Modal.getInstance(e);setTimeout((function(){r.hide()}),1e3)},handleSubmit:function(){var t=this;return Object(n["a"])(regeneratorRuntime.mark((function e(){var a,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(e.prev=0,t.comment){e.next=5;break}return t.isError=!0,t.errorMsg="內容不可空白",e.abrupt("return");case 5:return e.next=7,u["a"].postTweetReply({id:t.tweet.id,comment:t.comment});case 7:if(a=e.sent,r=a.data,"error"!==r.status){e.next=11;break}throw new Error(r.message);case 11:t.$emit("after-reply-submit",{tweetId:t.tweet.id,replyCount:t.tweet.replyCount+1}),t.$emit("after-single-reply",{User:t.currentUser,comment:t.comment,created_at:(new Date).toISOString()}),t.alertMsg="留言成功",t.alertStatus="success",t.alertShow(),t.comment="",t.hideModal(),e.next=26;break;case 20:e.prev=20,e.t0=e["catch"](0),t.comment="",t.alertMsg=e.t0.response.data.message,t.alertStatus="error",t.alertShow();case 26:case"end":return e.stop()}}),e,null,[[0,20]])})))()}}},m=d,p=(a("a167"),a("2877")),f=Object(p["a"])(m,r,s,!1,null,"c004f134",null);e["a"]=f.exports},"438c":function(t,e,a){"use strict";a("1582")},"4c78":function(t,e,a){"use strict";a.r(e);var r=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"d-flex flex-column vh-100"},[r("div",{staticClass:"title menu-text"},[t._v("首頁")]),r("NewTweet",{on:{"after-new-tweet":t.afterNewTweet}}),r("div",{staticClass:"border"}),r("div",{attrs:{id:"tweet-list"}},[t.isLoading?r("Spinner"):t._e(),t._l(t.allTweets,(function(e){return r("div",{key:e.id,staticClass:"tweet-card d-flex"},[r("router-link",{attrs:{to:{name:"user-profile",params:{userId:e.User.id}}}},[r("img",{staticClass:"avatar",attrs:{width:"50px",src:e.User.avatar,alt:""}})]),r("div",{staticClass:"tweet-info d-flex flex-column"},[r("div",{},[r("span",{staticClass:"text-name me-2"},[t._v(t._s(e.User.name))]),r("span",{staticClass:"text-account"},[t._v("@"+t._s(e.User.account)+"．"+t._s(t._f("fromNow")(e.createdAt)))])]),r("div",{staticClass:"tweet-content"},[r("router-link",{attrs:{to:{name:"single-tweet",params:{tweetId:e.id,tweet:e}}}},[t._v(" "+t._s(e.description)+" ")])],1),r("div",{staticClass:"action mt-auto my-1"},[r("button",{staticClass:"btn-reply",attrs:{"data-bs-toggle":"modal","data-bs-target":"#new-reply-modal"},on:{click:function(a){return t.handleReplyModal(e)}}},[r("img",{attrs:{src:a("6211"),width:"12px"}}),r("span",{staticClass:"text-like-reply"},[t._v(" "+t._s(e.replyCount)+" ")])]),e.isLike?r("button",{staticClass:"btn-like",attrs:{disabled:t.isProcessing},on:{click:function(a){return t.deleteLike(e.id)}}},[r("img",{attrs:{src:a("9267"),width:"12px"}}),r("span",{staticClass:"text-like-reply"},[t._v(t._s(e.likeCount))])]):r("button",{staticClass:"btn-like",attrs:{disabled:t.isProcessing},on:{click:function(a){return t.addLike(e.id)}}},[r("img",{attrs:{src:a("cb58"),width:"12px"}}),r("span",{staticClass:"text-like-reply"},[t._v(t._s(e.likeCount))])])])])],1)}))],2),r("NewReplyModal",{attrs:{tweet:t.tweetActive},on:{"after-reply-submit":t.afterReplySubmit}}),!1!==t.alertStatus?r("div",{staticClass:"alert d-flex fixed-top",attrs:{id:"alert",role:"alert"}},[r("div",{staticClass:"ms-2 mx-auto my-auto text-alert"},[t._v(t._s(t.alertMsg))]),r("div",{staticClass:"ms-auto"},["error"===t.alertStatus?r("img",{attrs:{src:a("ba0e")}}):"success"===t.alertStatus?r("img",{attrs:{src:a("08f6")}}):t._e()])]):t._e()],1)},s=[],n=a("1da1"),i=a("5530"),c=(a("96cf"),a("d81d"),a("d9e2"),function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"d-flex w-100",attrs:{id:"new-tweet"}},[r("div",[r("img",{staticClass:"avatar",attrs:{width:"50px",src:t.currentUser.avatar,alt:""}})]),r("div",{staticClass:"d-flex flex-column w-100"},[r("textarea",{directives:[{name:"model",rawName:"v-model",value:t.description,expression:"description"}],staticClass:"input-new-tweet mt-2 w-80",attrs:{placeholder:"有什麼新鮮事？"},domProps:{value:t.description},on:{input:function(e){e.target.composing||(t.description=e.target.value)}}}),r("div",{staticClass:"mt-auto ms-auto"},[t.isError?r("span",{staticClass:"text-danger"},[t._v(t._s(t.errorMsg))]):t._e(),r("button",{staticClass:"btn-active post",attrs:{type:"submit",disabled:t.isProcessing},on:{click:function(e){return e.preventDefault(),t.handleSubmit.apply(null,arguments)}}},[t._v(" 推文 ")])])]),!1!==t.alertStatus?r("div",{staticClass:"alert d-flex fixed-top",attrs:{id:"alert",role:"alert"}},[r("div",{staticClass:"ms-2 mx-auto my-auto text-alert"},[t._v(t._s(t.alertMsg))]),r("div",{staticClass:"ms-auto"},["error"===t.alertStatus?r("img",{attrs:{src:a("ba0e")}}):"success"===t.alertStatus?r("img",{attrs:{src:a("08f6")}}):t._e()])]):t._e()])}),o=[],l=(a("a4d3"),a("e01a"),a("b0c0"),a("2f62")),u=a("6783"),d={name:"NewTweet",data:function(){return{description:"",isError:!1,errorMsg:"",isProcessing:!1,alertMsg:"",alertStatus:!1}},computed:Object(i["a"])({},Object(l["b"])(["currentUser","newTweets"])),methods:{alertShow:function(){var t=this,e=a("7b17"),r=document.querySelector("#alert");e.Alert.getInstance(r),setTimeout((function(){t.alertStatus=!1}),2e3)},handleSubmit:function(){var t=this;return Object(n["a"])(regeneratorRuntime.mark((function e(){var a,r,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(e.prev=0,t.description){e.next=7;break}return t.isError=!0,t.errorMsg="內容不可空白",e.abrupt("return");case 7:if(!(t.description.length>140)){e.next=13;break}return t.isError=!0,t.errorMsg="字數不可超過 140 字",e.abrupt("return");case 13:t.isError=!1;case 14:return t.isProcessing=!0,e.next=17,u["a"].postTweet({description:t.description});case 17:a=e.sent,r=a.data,console.log(r),s={UserId:t.currentUser.id,description:t.description,replyCount:0,likeCount:0,createdAt:(new Date).toISOString(),User:{avatar:t.currentUser.avatar,name:t.currentUser.name,account:t.currentUser.account}},t.$store.commit("setNewTweet",s),t.$emit("after-new-tweet"),t.alertMsg="推文成功",t.alertStatus="success",t.alertShow(),t.isProcessing=!1,t.description="",e.next=35;break;case 30:e.prev=30,e.t0=e["catch"](0),t.alertMsg=e.t0.response.data.message,t.alertStatus="error",t.alertShow();case 35:case"end":return e.stop()}}),e,null,[[0,30]])})))()}}},m=d,p=(a("438c"),a("2877")),f=Object(p["a"])(m,c,o,!1,null,"7849c319",null),w=f.exports,v=a("2375"),g=a("3d4f"),b=a("c1df"),h=a.n(b),x={name:"TweetList",components:{NewTweet:w,NewReplyModal:g["a"],Spinner:v["a"]},data:function(){return{allTweets:[],isLoading:!0,alertMsg:"",alertStatus:!1,tweetActive:{User:{}},isProcessing:!1}},computed:Object(i["a"])({},Object(l["b"])(["newTweets"])),filters:{fromNow:function(t){return t?h()(t).fromNow():"-"}},created:function(){this.fetchTweets()},methods:{alertShow:function(){var t=this,e=a("7b17"),r=document.querySelector("#alert");e.Alert.getInstance(r),setTimeout((function(){t.alertStatus=!1}),2e3)},setNewTweets:function(){this.allTweets.unshift(Object(i["a"])({},this.newTweets[0]))},handleReplyModal:function(t){this.tweetActive=Object(i["a"])({},t)},fetchTweets:function(){var t=this;return Object(n["a"])(regeneratorRuntime.mark((function e(){var a,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,u["a"].getTweets();case 3:a=e.sent,r=a.data,t.allTweets=r.map((function(t){return Object(i["a"])({},t)})),t.isLoading=!1,e.next=15;break;case 9:e.prev=9,e.t0=e["catch"](0),t.isLoading=!1,t.alertMsg="取得推文失敗，請稍後再試",t.alertStatus="error",t.alertShow();case 15:case"end":return e.stop()}}),e,null,[[0,9]])})))()},addLike:function(t){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function a(){var r,s;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,u["a"].addLike({id:t});case 3:if(r=a.sent,s=r.data,e.isProcessing=!0,"error"!==s.status){a.next=8;break}throw new Error(s.message);case 8:e.allTweets=e.allTweets.map((function(e){return e.id!==t?e:Object(i["a"])(Object(i["a"])({},e),{},{likeCount:e.likeCount+1,isLike:!0})})),e.isProcessing=!1,a.next=17;break;case 12:a.prev=12,a.t0=a["catch"](0),e.alertMsg="按讚失敗，請稍後再試",e.alertStatus="error",e.alertShow();case 17:case"end":return a.stop()}}),a,null,[[0,12]])})))()},deleteLike:function(t){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function a(){var r,s;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,u["a"].deleteLike({id:t});case 3:if(r=a.sent,s=r.data,"error"!==s.status){a.next=7;break}throw new Error(s.message);case 7:e.isProcessing=!0,e.allTweets=e.allTweets.map((function(e){return e.id!==t?e:Object(i["a"])(Object(i["a"])({},e),{},{likeCount:e.likeCount-1,isLike:!1})})),e.isProcessing=!1,a.next=18;break;case 12:a.prev=12,a.t0=a["catch"](0),e.isProcessing=!1,e.alertMsg="取消讚失敗，請稍後再試",e.alertStatus="error",e.alertShow();case 18:case"end":return a.stop()}}),a,null,[[0,12]])})))()},afterNewTweet:function(){this.fetchTweets()},afterReplySubmit:function(t){var e=t.tweetId,a=t.replyCount;this.allTweets=this.allTweets.map((function(t){return t.id!==e?t:Object(i["a"])(Object(i["a"])({},t),{},{replyCount:a})}))}},watch:{newTweets:function(){this.newTweets.length>0&&this.setNewTweets()}}},C=x,_=(a("1c8c"),Object(p["a"])(C,r,s,!1,null,"119d05a4",null));e["default"]=_.exports},6211:function(t,e,a){t.exports=a.p+"img/Reply.3004ae28.svg"},6783:function(t,e,a){"use strict";a("a4d3"),a("e01a");var r=a("2fa3");e["a"]={getTweets:function(){return r["b"].get("/tweets")},getOneTweet:function(t){var e=t.id;return r["b"].get("/tweets/".concat(e))},postTweet:function(t){var e=t.description;return r["b"].post("/tweets",{description:e})},getTweetReplies:function(t){var e=t.id;return r["b"].get("/tweets/".concat(e,"/replies"))},postTweetReply:function(t){var e=t.id,a=t.comment;return r["b"].post("/tweets/".concat(e,"/replies"),{comment:a})},addLike:function(t){var e=t.id;return r["b"].post("/tweets/".concat(e,"/like"))},deleteLike:function(t){var e=t.id;return r["b"].post("/tweets/".concat(e,"/unlike"))}}},"7f3a":function(t,e,a){},9267:function(t,e,a){t.exports=a.p+"img/LikeActive.fc5a7556.svg"},a167:function(t,e,a){"use strict";a("f2f5")},cb58:function(t,e,a){t.exports=a.p+"img/Like.ac406642.svg"},d81d:function(t,e,a){"use strict";var r=a("23e7"),s=a("b727").map,n=a("1dde"),i=n("map");r({target:"Array",proto:!0,forced:!i},{map:function(t){return s(this,t,arguments.length>1?arguments[1]:void 0)}})},e01a:function(t,e,a){"use strict";var r=a("23e7"),s=a("83ab"),n=a("da84"),i=a("e330"),c=a("1a2d"),o=a("1626"),l=a("3a9b"),u=a("577e"),d=a("9bf2").f,m=a("e893"),p=n.Symbol,f=p&&p.prototype;if(s&&o(p)&&(!("description"in f)||void 0!==p().description)){var w={},v=function(){var t=arguments.length<1||void 0===arguments[0]?void 0:u(arguments[0]),e=l(f,this)?new p(t):void 0===t?p():p(t);return""===t&&(w[e]=!0),e};m(v,p),v.prototype=f,f.constructor=v;var g="Symbol(test)"==String(p("test")),b=i(f.toString),h=i(f.valueOf),x=/^Symbol\((.*)\)[^)]+$/,C=i("".replace),_=i("".slice);d(f,"description",{configurable:!0,get:function(){var t=h(this),e=b(t);if(c(w,t))return"";var a=g?_(e,7,-1):C(e,x,"$1");return""===a?void 0:a}}),r({global:!0,forced:!0},{Symbol:v})}},f2f5:function(t,e,a){}}]);
//# sourceMappingURL=chunk-240c9e05.0101a32f.js.map